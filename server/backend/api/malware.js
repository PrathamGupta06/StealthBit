import { Router } from "express" 
import Victim from '../models/victimModel.js' 
import Request from '../models/requestModel.js' 

const router = Router() 

router.post('/registerVictim', (req, res) => {
    const victim = new Victim({
        id: new mongoose.Types.ObjectId(),
        title: req.body.title,
        description: req.body.description,
        image: req.body.image ? req.body.image : null,
    }) 

    victim.save().then((doc) => {
        res.json(doc) 
    }).catch((err) => {
        res.status(400).json(err) 
    })
}) 

router.post('/updateLastSeen/:id', (req, res) => {
    const id = req.params.id 
    Victim.findOneAndUpdate({id: id}, {lastSeen: Date.now()}).then((doc) => {
        res.json(doc) 
    }).catch((err) => {
        res.status(400).json(err) 
    }) 
})

router.get('/requests/:victimId', (req, res) => {
    const victimId = req.params.victimId 
    Request.find({victimId: victimId}).then((docs) => {
        res.json(docs) 
    }
    ).catch((err) => {
        res.status(400).json(err) 
    }) 
})

router.route('/health')
    .get((req, res) => {
        res.send('OK');
});

export default router

